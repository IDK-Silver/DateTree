# DateTree 產品需求規格書

**文件版本**: 1.3

**最後更新日期**: 2025-06-29

**狀態**: 開發中 (In Development)

## 1. 專案願景 (Project Vision)

* **一句話概括**: 一個快速、可靠、支援協作的事件與待辦事項管理工具，旨在透過直觀的日曆與列表視圖，簡化個人與團隊的規劃流程。
* **核心理念**: `快速開啟，方便建立`。此理念應貫穿整個產品設計，優先保證核心功能的高效與易用性，避免不必要的複雜度。

## 2. 目標使用者 (Target Audience)

* **主要使用者**: 需要管理個人待辦事項與日常行程的個人用戶。
* **次要使用者**: 需要共同規劃特定目標或活動的小型團體（如家庭成員、專案小組、朋友群）。

## 3. 核心功能列表 (Core Features)

### A. 帳號與日曆系統 (Account & Calendar System)

* `[ ]` **使用者帳號**: 支援電子郵件註冊、登入、登出。密碼需使用強雜湊演算法儲存。
* `[ ]` **多日曆架構**:
  * `[ ]` **個人預設日曆**: 使用者註冊後，系統自動為其建立一個私有的「個人日曆」。
  * `[ ]` **建立共享日曆**: 使用者可以建立額外的日曆（例如：「家庭旅遊」、「工作專案」）。
  * `[ ]` **成員邀請與權限**: 日曆的擁有者可以透過電子郵件邀請其他已註冊使用者加入共享日曆。初期版本可先簡化權限為「可編輯」一種。

### B. 擴展式清單與事件管理 (Extensible List & Event Management)

* `[x]` **多類型清單架構**: 每個日曆可包含多個不同類型的清單（待辦清單、優先級清單等）。✅ **已實施**
* `[x]` **清單項目管理**: 在清單中新增、編輯、完成項目。✅ **已實施**
* `[x]` **清單 CRUD API**: 完整的清單建立、讀取、更新、刪除 API。✅ **已實施**
* `[ ]` **協作投票**: 在優先級清單中，團隊成員可以對項目投票決定優先順序。
* `[ ]` **從清單到事件**: 將清單項目轉換為日曆上的確定事件。
* `[ ]` **快速新增**: 主介面提供顯眼的輸入框，輸入文字後可立即在預設的「個人日曆」中建立一個待辦事項。
* `[ ]` **詳細編輯**: 使用者可點擊事件或清單項目進入詳細頁面，進行以下操作：
  * `[ ]` 修改標題。
  * `[ ]` **詳細描述**: 提供支援 Markdown 語法的編輯器，用於記錄筆記、清單等。
  * `[ ]` **時間指派**: 可為事件設定一個「到期日」或「時間區段」（開始時間 & 結束時間）。
  * `[ ]` **日曆切換**: 可將事件從一個日曆移動到使用者有權限編輯的另一個日曆。
* `[ ]` **狀態管理**: 清單項目和事件都擁有完成狀態（`待辦` / `完成`）。

### C. 檢視模式 (Views)

* `[ ]` **待辦清單頁 (Todo View)**: 以列表形式，清晰地展示所有**未完成**的事件。此視圖是 App 的核心入口之一。
* `[ ]` **日曆頁 (Calendar View)**: 以傳統的月/週/日視圖，視覺化展示所有**已指派時間**的事件。
* `[ ]` **視圖關係說明**:
  * 「待辦清單頁」與「日曆頁」是檢視事件資料的兩種不同維度，**而非互斥的分類**。
  * 一個狀態為「待辦」且擁有指定時間的事件，將會**同時出現**在這兩個視圖中。
  * 直到該事件狀態被更新為「完成」，它才會從「待辦清單頁」中移除。

## 4. 預計使用者流程範例 (Example User Flows)

* **流程範例 1：快速捕捉待辦事項與完成**
    1. 使用者 A 打開 App，預設進入「待辦清單」頁面。
    2. 她在頂端的快速新增欄位輸入「去超市買牛奶」，按下 Enter。
    3. 該事項立即在她的「個人」日曆中建立一個待辦清單項目。
    4. 數小時後，A 完成了採買。她再次打開 App，在清單中找到「去超市買牛奶」這一項，並點擊了它前面的核取方塊。
    5. 該事項被標示為完成，並從「待辦」清單中消失（或移至「已完成」區域）。

* **流程範例 2：從日曆規劃預定行程**
    1. 使用者 B 需要預約下週三的牙醫門診。他打開 App 並切換到「日曆」頁面。
    2. 他點擊下週三的日期格子，彈出新增事件的視窗。
    3. 在視窗中，他輸入標題「牙醫複診」，設定時間為上午 10:00，並確認日曆為「個人日曆」。
    4. 點擊儲存後，該事件出現在日曆的正確位置上，同時也會出現在「待辦清單」中。

* **流程範例 3：建立共享日曆並協作投票**
    1. 使用者 C 想要和朋友 D 一起規劃週末的登山活動。
    2. C 進入 App 的日曆管理頁面，點擊「建立新日曆」，命名為「週末登山團」。
    3. 在新日曆的設定中，C 點擊「邀請成員」，並輸入朋友 D 的電子郵件。
    4. D 收到邀請通知，在 App 中點擊「接受」。現在 D 的日曆清單中也出現了「週末登山團」。
    5. C 在「週末登山團」日曆中建立一個「景點優先級清單」，並新增了幾個登山地點選項。  
    6. C 和 D 都可以對這些地點進行投票，最高票的地點會被優先考慮。
    7. 確定地點後，C 將勝出的項目轉換為日曆事件：「週六早上 8:00 集合 - 陽明山步道」。
    8. D 打開 App，在他的日曆上同樣看到了這個集合事件。他點進事件，並在描述中補充了「要記得帶頭燈和雨衣」。C 也能看到 D 補充的內容。

## 5. 技術架構與限制 (Technical Architecture & Constraints)

* **後端框架**: FastAPI
* **資料庫**: PostgreSQL
* **資料模型架構**: 採用擴展式多清單模型
  * `User ←→ Calendar` (多對多關係)
  * `Calendar → List` (一對多，支援不同類型清單)
  * `List → ListItem` (一對多)
  * `ListItem ← Vote` (支援協作投票)
  * `Calendar → Event` (已排程事件)
* **安全性**:
  * **權限控制**: 所有 API 端點都必須嚴格執行權限校驗。使用者只能對其擁有權限的日曆及其中的事件進行操作。
  * **輸入驗證**: 對所有來自使用者的輸入（特別是 Markdown 內容）進行清理，防止 XSS 攻擊。
* **離線功能 (Offline Functionality)**:
  * **離線檢視**: 前端應用應快取資料，允許使用者在沒有網路連線時**檢視**已同步的日曆和事件。
  * **禁止離線編輯**: 在離線狀態下，所有會產生資料變更的操作（新增、編輯、刪除）都應被禁用，以避免資料衝突。

## 6. 未來規劃 (Future Considerations - Not in v1.0)

* **即時協作 (Real-time Collaboration)**: 引入 WebSocket，當共享日曆中的事件發生變化時，即時通知所有在線的成員。
* **進階權限控制**: 為共享日曆的成員提供更細緻的權限設定（例如：「僅供檢視」、「可新增事件但不可修改他人事件」等）。
* **檔案附件**: 允許使用者將檔案或圖片附加到事件中。
* **提醒與通知**: 透過系統通知或電子郵件，在事件即將到來時提醒使用者。

## 7. 專案開發狀態 (Development Status)

### 已完成的功能 ✅

#### 後端架構

* **資料模型重構**: 完整實施擴展式多清單模型
* **資料庫設計**: PostgreSQL 資料庫設計和遷移
* **Complete API System**: 完整的 REST API 系統 ✅ **更新**
  * **List CRUD API**: 清單管理 API
  * **ListItem CRUD API**: 清單項目管理 API ✅ **新增**
  * **Vote API**: 協作投票 API ✅ **新增**
  * **Event API**: 事件管理 API ✅ **新增**
  * **User Registration API**: 用戶註冊 API
  * **Calendar Management API**: 日曆管理 API
* **測試架構**: pytest 測試架構，41 個測試全部通過

#### 開發工具

* **開發環境**: FastAPI + PostgreSQL + uv 開發環境
* **程式碼品質**: SQLAlchemy ORM + Pydantic 資料驗證
* **文檔系統**: 完整的技術文檔和 API 文檔

### 開發中的功能 🚧

* **登入認證**: JWT token 驗證系統（用戶註冊已完成）

### 計劃中的功能 📋

* **前端應用**: React/Vue.js 前端介面
* **即時協作**: WebSocket 實時更新
* **通知系統**: 事件提醒和通知

## 8. 開發環境設定 (Development Setup)

### 重要提醒

**如果您正在更新現有的開發環境**，請參閱 [開發環境設定指南](docs/guides/development-setup.md) 了解完整的設定步驟。

### 後端 (Backend)

詳細的後端開發環境設定請參閱：

* [後端 README](backend/README.md) - 基本設定和使用指南
* [開發環境設定指南](docs/guides/development-setup.md) - 完整的開發環境設定
* [測試指南](docs/development/testing-guide.md) - 測試架構和最佳實踐

### 前端 (Frontend)

(計劃中，尚未實施)

### API 文檔

啟動後端服務器後，可以查看：

* **Swagger UI**: <http://localhost:8000/docs>
* **ReDoc**: <http://localhost:8000/redoc>

## 9. 技術文檔 (Technical Documentation)

完整的技術文檔請參閱 [docs/](docs/) 目錄：

* **📁 [架構文檔](docs/architecture/)** - 系統架構和資料模型
* **📁 [開發指南](docs/guides/)** - 開發環境和最佳實踐  
* **📁 [ADR 文檔](docs/adr/)** - 重要的架構決策記錄
* **📁 [實施文檔](docs/implementation/)** - 功能實施詳情
* **📁 [開發實務](docs/development/)** - 測試和開發流程

## 10. 如何貢獻 (Contributing)

我們歡迎任何形式的貢獻！如果您希望參與程式碼的開發，請先閱讀我們的 [貢獻指南 (CONTRIBUTING.md)](CONTRIBUTING.md) 來了解我們的開發流程與程式碼架構。
